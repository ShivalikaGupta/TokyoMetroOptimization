<!DOCTYPE html>
<!--Source: https://www.w3schools.com/w3css/w3css_templates.asp-->
<html>
    <head>
        <title>W3.CSS Template</title>
        <meta charset="UTF-8">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>    
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Raleway">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <style>
            html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
            h5{
                font-size: 20px;
            }
            header {
                color: rgb(255, 255, 255);
                background-color: rgb(0, 0, 0);
                padding: 10px 10px 40px 10px;
                opacity: .8;
                font-size: 20px;
                text-align: center;
            }
        </style>
    </head>
    <body class="w3-light-grey">
        <header>
            <h1 class="title">Tokyo Metro Path Optimization</h1>
        </header>

        <!-- !PAGE CONTENT! -->
        <div class="w3-main" style="margin-top:43px;">

            <!-- Header -->
            <div class="w3-container" style="padding-top:22px">
                <h5><b><i class="fa fa-dashboard"></i> Reducing: </b></h5>
            </div>
            <div class="w3-panel">
            <div class="w3-row-padding w3-margin-bottom">
                <div class="w3-third">
                    <div class="w3-container w3-blue w3-padding-16" id = "dist">
                        <div class="w3-left"><i class="fa fa-map-o
                                w3-xxxlarge"></i></div>
                        <div class="w3-clear"></div>
                        <h4>Total Distance</h4>
                    </div>
                </div>
                <div class="w3-third">
                    <div class="w3-container w3-red w3-padding-16" id = "stops">
                        <div class="w3-left"><i class="fa fa-minus-circle w3-xxxlarge"></i></div>
                        <div class="w3-clear"></div>
                        <h4>Number of stops</h4>
                    </div>
                </div>
                <div class="w3-third">
                    <div class="w3-container w3-orange w3-padding-16" id = "transfers">
                        <div class="w3-left"><i class="fa fa-share-alt
                                w3-xxxlarge"></i></div>
                        <div class="w3-clear"></div>
                        <h4>Number of Transfers</h4>
                    </div>
                </div>
            </div>
        </div>
            <div class="w3-panel">
                <div class="w3-row-padding" style="margin:0 -16px">
                  
                  <div class="w3-twothird">
                    <h5>Regions</h5>
                    <svg id="tokyo" height="500" width="960" style="margin:5px"></svg>
                        <script>
                            const map = d3.select("svg#tokyo");
                            let width = map.attr("width");
                            let height = map.attr("height");
                            let viewport = map.append("g");
                            const requestData = async function() {
                                
                                const data = await d3.json("../static/images/tokyo.geojson");
                                console.log(data);
                                //viewport.attr("transform", "translate (-150, -100)");
                                var projection = d3.geoMercator()
                                        .center([-1000, -60 ])
                                        .scale(150)
                                        .rotate([-180,0])
                                        .fitSize([width*2, height*4.5], data)
                                        .clipExtent([[200, 0],[600, 300]]);
                                        
                                var path = d3.geoPath()
                                            .projection(projection);
                                // viewport.attr("transform", "scale(5)");
                                
                                // const path = d3.geoPath().projection(d3.geoConicConformal()
                                // // 
                                // // .scaleExtent([1, 10]).scale(1).translate([0, 0])
                                // .rotate([96, 65])
                                // .fitSize([width*2, height*2], data)
                                // //.scale(1)
                                // // .translate([2, 2])
                                // //
                                // //.scaleExtent(2)
                                
                                // .clipExtent([[width/3, height/8],[width,height/2]])
                                
                                // // .center([20,20])
                                // // 
                                // );
                                let boroughs = viewport.selectAll("path")
                                    .data(data.features)
                                    .enter().append("path")
                                    .attr("d", path)
                                    .style("stroke", "#000")
                                    .style("stroke-width", 1)
                                    .attr("id", "nycPath");
                                // const transform = {k: 8.808098366584408, x: -2700.945642323929, y: -1550.6131159310576};
                                // viewport.attr("transform", transform.toString() );
                                // viewport.select(".zips-outline")
                                //         .style("stroke-width", 1 / transform.k);
                                // map.call(d3.zoom());
                                var zoom = d3.zoom()
                                    .scaleExtent([1,10])
                                    .on("zoom", mapZoomed);

                                map.call(zoom);

                                function mapZoomed({transform}) { 
                                    console.log(transform);
                                    viewport.attr("transform", transform.toString() );
                                    viewport.select(".zips-outline")
                                            .style("stroke-width", 1 / transform.k);
                                }
                            }
                            requestData();
                        </script>
                  </div>
                  <div class="w3-third">
                    <div class="w3-container">
                        <h5>Stations Along The Path</h5>
                        <table class="w3-table w3-striped w3-bordered w3-border
                            w3-hoverable w3-white" id = "pathTable">
                            <tr>
                                <td>Number</td>
                                <td>Stop Name</td>
                                <td>Station ID</td>
                            </tr>
                        </table><br>
                        
                    </div>
                  </div>
                </div>
              </div>
              <h5>Feeds</h5>
                        <table class="w3-table w3-striped w3-white">
                            <tr id = "t_distance">
                                <td><i class="fa fa-map-o w3-text-blue w3-large"></i></td>
                                <td>Total Distance: </td>
                            </tr>
                            <tr id = "num_stops">
                                <td><i class="fa fa-minus-circle w3-text-red w3-large"></i></td>
                                <td>Number of stops: </td>
                            </tr>
                            <tr id = "num_transfers">
                                <td><i class="fa fa-share-alt w3-text-orange
                                        w3-large"></i></td>
                                <td>Number of transfers: </td>
                            </tr>
                            <tr>
                                <td><i class="fa fa-plus-square w3-text-green
                                        w3-large"></i></td>
                                <td>Add a new station: </td>
                                <td><i>Yes</i></td>
                            </tr>

                        </table>
                <!-- <div class="w3-row-padding" style="margin:0 -16px">
                    <div class="w3-twothird">
                        <h5>Regions</h5>
                        <svg id="tokyo" height="600" width="600" style="margin:5px"></svg>
                        <script>
                            const map = d3.select("svg#tokyo");
                            let width = map.attr("width");
                            let height = map.attr("height");
                            let viewport = map.append("g");
                            const requestData = async function() {
                                
                                const data = await d3.json("../static/images/tokyo.geojson");
                                console.log(data);
                                const path = d3.geoPath().projection(d3.geoConicConformal()
                                // .parallels([33, 45])
                                .translate([width, height])
                                .center([-2000,-20])
                                // .scaleExtent(10)
                                .rotate([96, 65])
                                // 
                                .fitSize([width, height], data));
                                let boroughs = viewport.selectAll("path")
                                    .data(data.features)
                                    .enter().append("path")
                                    .attr("d", path)
                                    .style("stroke", "#000")
                                    .style("stroke-width", 1)
                                    .attr("id", "nycPath");
                                var zoom = d3.zoom()
                                    .scaleExtent([1,10])
                                    .on("zoom", mapZoomed);

                                map.call(zoom);

                                function mapZoomed({transform}) { 
                                    viewport.attr("transform", transform.toString() );
                                    viewport.select(".zips-outline")
                                            .style("stroke-width", 1 / transform.k);
                                }
                            }
                            requestData();
                        </script>
                    </div>
                    <div class="w3-onethird">
                        <h5>Feeds</h5>
                        <table class="w3-table w3-striped w3-white">
                            <tr id = "t_distance">
                                <td><i class="fa fa-map-o w3-text-blue w3-large"></i></td>
                                <td>Total Distance: </td>
                            </tr>
                            <tr id = "num_stops">
                                <td><i class="fa fa-minus-circle w3-text-red w3-large"></i></td>
                                <td>Number of stops: </td>
                            </tr>
                            <tr id = "num_transfers">
                                <td><i class="fa fa-share-alt w3-text-orange
                                        w3-large"></i></td>
                                <td>Number of transfers: </td>
                            </tr>
                            <tr>
                                <td><i class="fa fa-plus-square w3-text-green
                                        w3-large"></i></td>
                                <td>Add a new station: </td>
                                <td><i>Yes</i></td>
                            </tr>

                        </table>
                    </div>
                </div>
            </div> -->

           
            <hr>

        <hr>
        <div class="w3-container">
            <h5>General Stats</h5>
            <p>New Visitors</p>
            <div class="w3-grey">
                <div class="w3-container w3-center w3-padding w3-green"
                    style="width:25%">+25%</div>
            </div>

            <p>New Users</p>
            <div class="w3-grey">
                <div class="w3-container w3-center w3-padding w3-orange"
                    style="width:50%">50%</div>
            </div>

            <p>Bounce Rate</p>
            <div class="w3-grey">
                <div class="w3-container w3-center w3-padding w3-red"
                    style="width:75%">75%</div>
            </div>
        </div>
        <hr>
        <a href="index.html"><button class="w3-button w3-dark-grey ">New Path  <i
            class="fa fa-arrow-right"></i></button></a>
    </body>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const start_station = urlParams.get('s');
        const end_station = urlParams.get('e');
        const dist = urlParams.get('d');
        console.log(dist);
        const trans = urlParams.get('t');
        const stops = urlParams.get('st');
        var path = urlParams.get('path');
        var count = 1;
        
        var table = document.getElementById('pathTable');
        console.log(typeof(path));
        path = path.split(",");
        console.log(typeof(path));
        path.forEach(ele => {
            var name = "";
            fetch('/get_name?curr=' + ele).then(function (response) {
                    return response.json();
                }).then(function (text) {
                    console.log(text.curr)
                    name = text.curr;
                    var newRow = table.insertRow();
                    var countCell = newRow.insertCell();
                    var countText = document.createTextNode(String(count));
                    count +=1;
                    countCell.appendChild(countText);
                    var newCell = newRow.insertCell();
                    var newText = document.createTextNode(name)
                    newCell.appendChild(newText);
                    var stationIDcell = newRow.insertCell()
                    var stationIDText = document.createTextNode(ele)
                    stationIDcell.appendChild(stationIDText);
                });


            
        });
        var dist_div = document.getElementById( 'dist' );
        var transfers_div = document.getElementById( 'transfers' );
        var stops_div = document.getElementById( 'stops' );;
        console.log(dist_div)
        const distance = urlParams.get('distance');
        const transfers = urlParams.get('transfers');
        const stops_2 = path.length;
        
        
        var dist_row = document.getElementById('t_distance');
        var distcell = dist_row.insertCell();
        var distText = document.createTextNode(distance );
        distcell.appendChild(distText);
        var stop_row = document.getElementById('num_stops');
        var stopcell = stop_row.insertCell();
        var stopText = document.createTextNode(String(stops_2));
        stopcell.appendChild(stopText);
        var transfers_row = document.getElementById('num_transfers');
        var transferscell = transfers_row.insertCell();
        var transfersText = document.createTextNode(transfers);
        transferscell.appendChild(transfersText);
        if (dist === "false") {
            dist_div.style.display = "none";
        }
        if (trans === "false") {
            transfers_div.style.display = "none";
        }
        if (stops === "false") {
            stops_div.style.display = 'none';
        }
    </script>
</html>
